From f6c121c8a4f25dec2a2d1edc26d0b13d1ee97ee9 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Fri, 1 Sep 2017 16:27:58 -0500
Subject: [PATCH 2/2] stm32f469-disco: demo

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/stm32f429.dtsi      |  2 +-
 arch/arm/boot/dts/stm32f469-disco.dts | 12 ++++++++++++
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/stm32f429.dtsi b/arch/arm/boot/dts/stm32f429.dtsi
index b2a2b5c38caa..1b14b75b28b0 100644
--- a/arch/arm/boot/dts/stm32f429.dtsi
+++ b/arch/arm/boot/dts/stm32f429.dtsi
@@ -429,6 +429,9 @@
 			interrupts = <71>;
 			clocks = <&rcc 0 STM32F4_APB2_CLOCK(USART6)>;
 			status = "disabled";
+			dmas = <&dma2 1 5 0x400 0x0>,
+			       <&dma2 6 5 0x400 0x0>;
+			dma-names = "rx", "tx";
 		};
 
 		adc: adc@40012000 {
@@ -672,6 +675,19 @@
 				};
 			};
 
+			usart6_pins_a: usart6@0 {
+				pins1 {
+					pinmux = <STM32F429_PG14_FUNC_USART6_TX>;
+					bias-disable;
+					drive-push-pull;
+					slew-rate = <0>;
+				};
+				pins2 {
+					pinmux = <STM32F429_PG9_FUNC_USART6_RX>;
+					bias-disable;
+				};
+			};
+
 			usbotg_fs_pins_a: usbotg_fs@0 {
 				pins {
 					pinmux = <STM32F429_PA10_FUNC_OTG_FS_ID>,
@@ -758,7 +774,7 @@
 			i2c1_pins: i2c1@0 {
 				pins {
 					pinmux = <STM32F429_PB9_FUNC_I2C1_SDA>,
-						 <STM32F429_PB6_FUNC_I2C1_SCL>;
+						 <STM32F429_PB8_FUNC_I2C1_SCL>;
 					bias-disable;
 					drive-open-drain;
 					slew-rate = <3>;
diff --git a/arch/arm/boot/dts/stm32f469-disco.dts b/arch/arm/boot/dts/stm32f469-disco.dts
index 75470c34b92c..cf9a17b85903 100644
--- a/arch/arm/boot/dts/stm32f469-disco.dts
+++ b/arch/arm/boot/dts/stm32f469-disco.dts
@@ -63,6 +63,7 @@
 
 	aliases {
 		serial0 = &usart3;
+		serial1 = &usart6;
 	};
 
 	soc {
@@ -125,6 +126,24 @@
 	status = "okay";
 };
 
+&usart6 {
+	pinctrl-0 = <&usart6_pins_a>;
+	pinctrl-names = "default";
+	status = "okay";
+};
+
+&i2c1 {
+	pinctrl-0 = <&i2c1_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+	clock-frequency = <100000>;
+
+	si7005@40 {
+		compatible = "si7005";
+		reg = <0x40>;
+	};
+};
+
 &usbotg_fs {
 	dr_mode = "host";
 	pinctrl-0 = <&usbotg_fs_pins_a>;
-- 
2.14.1

